<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>The Silent Hour â€“ Novel App</title>

<style>
body {
  background:#0f1220;
  color:#eaeaf0;
  font-family:Inter, Arial, sans-serif;
  padding:24px;
}
.container { max-width:800px; margin:auto; }
.card {
  background:#171a2f;
  padding:28px;
  border-radius:16px;
  margin-bottom:24px;
}
a { color:#6c7cff; text-decoration:none; }
h1,h2,h3 { font-family:Georgia; }
input, textarea {
  width:100%;
  padding:10px;
  margin:10px 0;
  border-radius:8px;
  border:1px solid #6c7cff;
  background:#0f1220;
  color:#eaeaf0;
}
button {
  width:48%;
  padding:10px;
  margin:5px 1%;
  border:none;
  border-radius:8px;
  background:#6c7cff;
  color:white;
  cursor:pointer;
}
button:hover { background:#515aff; }
.hidden { display:none; }
.bookmark { color:#ffcc00; font-weight:bold; }
.comment {
  background:#1e2137;
  padding:8px;
  margin:6px 0;
  border-radius:8px;
}
@media(max-width:600px){
  button{width:100%; margin:6px 0;}
}
</style>
</head>

<body>

<!-- LOADING -->
<div id="loading" style="position:fixed;inset:0;background:#0f1220;
display:flex;align-items:center;justify-content:center;color:#6c7cff;z-index:9999;">
Loadingâ€¦
</div>

<div class="container">

<h1>ğŸ“– The Silent Hour</h1>
<p>Written by Tieg â€¢ Weekly updates</p>

<!-- LOGIN -->
<div class="card hidden" id="loginCard">
  <h2>ğŸ”‘ Login / Sign Up</h2>
  <input type="email" id="email" placeholder="Email">
  <input type="password" id="password" placeholder="Password">
  <input type="password" id="confirmPassword" placeholder="Confirm Password (Sign Up)">
  <button onclick="login()">Login</button>
  <button onclick="signup()">Sign Up</button>
  <p><a href="#" onclick="forgotPassword()">Forgot Password?</a></p>
  <div id="msg"></div>
</div>

<div class="card hidden" id="logoutCard">
  <button onclick="logout()">Logout</button>
</div>

<div id="content" class="hidden">

<!-- CONTINUE READING -->
<div class="card" id="bookmarkCard" style="display:none;">
  <h2>â­ Continue Reading</h2>
  <p id="lastReadText"></p>
  <a id="continueLink" href="#">ğŸ‘‰ Continue</a>
</div>

<!-- CHAPTERS -->
<div class="card">
<h2>ğŸ“š Chapters</h2>
<p><a href="chapter1.html" id="ch1">Chapter 1: When the Clock Stopped</a></p>
<p><a href="chapter2.html" id="ch2">Chapter 2: The Invitation</a></p>
<p><a href="chapter3.html" id="ch3">Chapter 3: The Second That Broke Time</a></p>
</div>

<!-- COMMENTS -->
<div class="card">
<h3>ğŸ’¬ Comments</h3>
<textarea id="commentInput" placeholder="Write a comment..."></textarea>
<button onclick="postComment()">Post Comment</button>
<div id="commentList"></div>
</div>

<!-- HOW TO USE -->
<div class="card">
<h2>â“ How to Use This App</h2>

<h3>ğŸ”‘ Login / Sign Up</h3>
<p>Create an account with your email and password.</p>

<h3>ğŸ” Forgot Password</h3>
<p>
Enter your email â†’ click <b>Forgot Password</b> â†’
check your email â†’ reset your password securely.
</p>

<h3>â­ Bookmarks</h3>
<p>
Click any chapter. The app automatically saves your last read chapter.
Use <b>Continue Reading</b> when you return.
</p>

<h3>ğŸ’¬ Comments</h3>
<p>
Write comments and click <b>Post Comment</b>. Comments are saved permanently.
</p>

<h3>ğŸ”’ Security</h3>
<p>
Passwords are encrypted and securely handled by Firebase.
</p>
</div>

<p style="text-align:center;font-size:0.85rem;">Â© 2026 The Silent Hour</p>

</div>
</div>

<!-- FIREBASE -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
import {
  getAuth, setPersistence, browserLocalPersistence,
  createUserWithEmailAndPassword, signInWithEmailAndPassword,
  onAuthStateChanged, signOut, sendPasswordResetEmail
} from "https://www.gstatic.com/firebasejs/9.22.2/firebase-auth.js";
import {
  getFirestore, doc, setDoc, getDoc
} from "https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyD9PdBAZzQeZbb4z1_vC-Nlc9v46xVMQ6E",
  authDomain: "my-novel-app-ce68b.firebaseapp.com",
  projectId: "my-novel-app-ce68b"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);
setPersistence(auth, browserLocalPersistence);

// AUTH STATE
onAuthStateChanged(auth, async user => {
  loading.style.display = "none";
  if (user) {
    loginCard.classList.add("hidden");
    content.classList.remove("hidden");
    logoutCard.classList.remove("hidden");
    loadBookmark(user);
    loadComments();
  } else {
    loginCard.classList.remove("hidden");
    content.classList.add("hidden");
    logoutCard.classList.add("hidden");
  }
});

// AUTH FUNCTIONS
window.login = () =>
  signInWithEmailAndPassword(auth, email.value, password.value);

window.signup = () => {
  if (password.value !== confirmPassword.value) return;
  createUserWithEmailAndPassword(auth, email.value, password.value);
};

window.logout = () => signOut(auth);

window.forgotPassword = () => {
  if (email.value)
    sendPasswordResetEmail(auth, email.value);
};

// BOOKMARKS
const chapters = {
  ch1:{t:"Chapter 1: When the Clock Stopped",l:"chapter1.html"},
  ch2:{t:"Chapter 2: The Invitation",l:"chapter2.html"},
  ch3:{t:"Chapter 3: The Second That Broke Time",l:"chapter3.html"}
};

["ch1","ch2","ch3"].forEach(id=>{
  document.getElementById(id).addEventListener("click",()=>{
    if(auth.currentUser){
      setDoc(doc(db,"bookmarks",auth.currentUser.uid),{last:id});
      showBookmark(id);
    }
  });
});

async function loadBookmark(user){
  const snap = await getDoc(doc(db,"bookmarks",user.uid));
  if(snap.exists()) showBookmark(snap.data().last);
}

function showBookmark(id){
  bookmarkCard.style.display="block";
  lastReadText.innerText="Last read: "+chapters[id].t;
  continueLink.href=chapters[id].l;
}

// COMMENTS (FIXED)
window.postComment = async () => {
  if (!auth.currentUser) return;

  const input = document.getElementById("commentInput");
  const listDiv = document.getElementById("commentList");
  if (!input.value.trim()) return;

  const ref = doc(db,"comments","main");
  const snap = await getDoc(ref);
  let list = snap.exists() ? snap.data().list : [];

  list.push({
    user: auth.currentUser.email,
    text: input.value,
    time: Date.now()
  });

  await setDoc(ref,{list});
  input.value="";
  loadComments();
};

async function loadComments(){
  const listDiv = document.getElementById("commentList");
  listDiv.innerHTML="";
  const snap = await getDoc(doc(db,"comments","main"));
  if(!snap.exists()) return;

  snap.data().list.forEach(c=>{
    const p = document.createElement("p");
    p.className="comment";
    p.innerHTML =
      `<b>${c.user}</b> (${new Date(c.time).toLocaleString()}): ${c.text}`;
    listDiv.appendChild(p);
  });
}
</script>

</body>
</html>