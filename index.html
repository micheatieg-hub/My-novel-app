<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>The Silent Hour â€“ Novel App</title>
<style>
body { background:#0f1220; color:#eaeaf0; font-family:Inter, Arial, sans-serif; padding:24px; }
.container { max-width:800px; margin:auto; }
.card { background:#171a2f; padding:28px; border-radius:16px; margin-bottom:24px; }
a { color:#6c7cff; text-decoration:none; }
h1,h2 { font-family:Georgia; }
input, textarea, button { width:100%; margin:6px 0; padding:10px; border-radius:8px; border:none; }
button { background:#6c7cff; color:#fff; cursor:pointer; }
button:hover { background:#515aff; }
.hidden { display:none; }
.comment { background:#1e2137; padding:8px; margin:6px 0; border-radius:8px; }
#errorMsg { color:#ff5a5a; margin:6px 0; }
</style>
</head>
<body>
<div class="container">

<h1>ğŸ“– The Silent Hour</h1>
<p>Written by Tieg â€¢ Weekly updates</p>

<!-- Chapters (hidden until login) -->
<div class="card hidden" id="chaptersCard">
<h2>ğŸ“š Chapters</h2>
<p><a href="chapter1.html">Chapter 1: When the Clock Stopped</a></p>
<p><a href="chapter2.html">Chapter 2: The Invitation</a></p>
<p><a href="chapter3.html">Chapter 3: The Second That Broke Time</a></p>
</div>

<div class="card">
<h2>ğŸ”” Notice</h2>
<p>This is an original novel. New chapters are added every week.</p>
</div>

<div class="card">
<h2>â„¹ï¸ App Info</h2>
<p>
<a href="about.html">About</a> â€¢
<a href="privacy.html">Privacy Policy</a> â€¢
<span style="color:#a5a8c6;">Terms â€“ Coming Soon</span>
</p>
</div>

<!-- Login / Signup -->
<div class="card" id="loginCard">
  <h2>ğŸ”‘ Login / Sign Up</h2>
  <input type="email" id="email" placeholder="Email">
  <input type="password" id="password" placeholder="Password">
  <input type="password" id="confirmPassword" placeholder="Confirm Password (Sign Up)">
  <button onclick="login()">Login</button>
  <button onclick="signup()">Sign Up</button>
  <p><a href="#" onclick="forgotPassword()">Forgot Password?</a></p>
  <p id="errorMsg"></p>
</div>

<div class="card hidden" id="logoutCard">
  <button onclick="logout()">Logout</button>
</div>

<!-- Comments -->
<div class="card hidden" id="commentSection">
  <h2>ğŸ’¬ Comments</h2>
  <textarea id="commentInput" placeholder="Write a comment..."></textarea>
  <button onclick="postComment()">Post Comment</button>
  <div id="commentList"></div>
</div>

<!-- Banner Ad -->
<div id="frame" style="width:100%;margin:40px auto;position:relative;z-index:99998;">
  <iframe data-aa="2426169" src="//acceptable.a-ads.com/2426169/?size=Adaptive"
    style="border:0;padding:0;width:70%;height:auto;overflow:hidden;display:block;margin:auto">
  </iframe>
</div>

<p style="text-align:center;font-size:0.85rem;">Â© 2026 The Silent Hour</p>

</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut, sendPasswordResetEmail } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-auth.js";
import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js";

// Firebase config
const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_PROJECT.firebaseapp.com",
  projectId: "YOUR_PROJECT_ID",
  storageBucket: "YOUR_PROJECT.appspot.com",
  messagingSenderId: "YOUR_SENDER_ID",
  appId: "YOUR_APP_ID"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

// Elements
const loginCard = document.getElementById('loginCard');
const logoutCard = document.getElementById('logoutCard');
const chaptersCard = document.getElementById('chaptersCard');
const commentSection = document.getElementById('commentSection');
const commentList = document.getElementById('commentList');
const emailInput = document.getElementById('email');
const passwordInput = document.getElementById('password');
const confirmPassword = document.getElementById('confirmPassword');
const commentInput = document.getElementById('commentInput');
const errorMsg = document.getElementById('errorMsg');

// Login / Signup functions
function login() { 
  errorMsg.innerText = '';
  if(!emailInput.value || !passwordInput.value) {
    errorMsg.innerText = "Enter email and password";
    return;
  }
  signInWithEmailAndPassword(auth, emailInput.value, passwordInput.value)
    .catch(e => {
      if(e.code === 'auth/wrong-password') errorMsg.innerText = "Incorrect password";
      else if(e.code === 'auth/user-not-found') errorMsg.innerText = "User not found";
      else if(e.code === 'auth/invalid-email') errorMsg.innerText = "Invalid email";
      else errorMsg.innerText = e.message;
    });
}

function signup() {
  errorMsg.innerText = '';
  if(!emailInput.value || !passwordInput.value || !confirmPassword.value){
    errorMsg.innerText = "Fill all fields";
    return;
  }
  if(passwordInput.value !== confirmPassword.value){
    errorMsg.innerText = "Passwords do not match";
    return;
  }
  createUserWithEmailAndPassword(auth, emailInput.value, passwordInput.value)
    .catch(e => {
      if(e.code === 'auth/email-already-in-use') errorMsg.innerText = "Email already in use";
      else if(e.code === 'auth/weak-password') errorMsg.innerText = "Password too weak (min 6 chars)";
      else if(e.code === 'auth/invalid-email') errorMsg.innerText = "Invalid email";
      else errorMsg.innerText = e.message;
    });
}

function logout() { signOut(auth); }

function forgotPassword() {
  errorMsg.innerText = '';
  if(!emailInput.value) { errorMsg.innerText = "Enter your email"; return; }
  sendPasswordResetEmail(auth,emailInput.value)
    .then(()=> alert("Reset email sent"))
    .catch(e=> errorMsg.innerText = e.message);
}

// Auth state change
onAuthStateChanged(auth,user=>{
  if(user){
    loginCard.classList.add("hidden");
    logoutCard.classList.remove("hidden");
    chaptersCard.classList.remove("hidden");
    commentSection.classList.remove("hidden");
    loadComments();
  } else {
    loginCard.classList.remove("hidden");
    logoutCard.classList.add("hidden");
    chaptersCard.classList.add("hidden");
    commentSection.classList.add("hidden");
  }
});

// Comments
async function postComment(){
  const user = auth.currentUser;
  if(!user) return alert("Login first");
  const text = commentInput.value.trim();
  if(!text) return;
  const docRef = doc(db,"comments","chapter1");
  const snap = await getDoc(docRef);
  let list = snap.exists()?snap.data().list:[];
  list.push({user:user.email,text,time:Date.now()});
  await setDoc(docRef,{list});
  commentInput.value='';
  loadComments();
}

async function loadComments(){
  commentList.innerHTML='';
  const snap = await getDoc(doc(db,"comments","chapter1"));
  if(!snap.exists()) return;
  snap.data().list.forEach(c=>{
    const p=document.createElement('p');
    const date=new Date(c.time).toLocaleTimeString();
    p.innerHTML=`<b>${c.user}</b> [${date}]: ${c.text}`;
    p.className='comment';
    commentList.appendChild(p);
  });
}
</script>
</body>
</html>